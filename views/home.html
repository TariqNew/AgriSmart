<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AgriSmart</title>
    <link rel="stylesheet" href="styles/home.css" />
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #e0ffe0;
        margin: 0;
        padding: 0;
      }
      .hero {
        background: linear-gradient(90deg, #388e3c 0%, #b2dfdb 100%);
        color: #fff;
        padding: 64px 0 48px 0;
        text-align: center;
      }
      .hero h1 {
        font-size: 2.8em;
        margin-bottom: 0.3em;
        font-weight: 700;
        letter-spacing: -1px;
      }
      .hero p {
        font-size: 1.3em;
        margin-bottom: 1.5em;
        font-weight: 400;
      }
      .hero .cta-btn {
        background: #fff;
        color: #388e3c;
        border: none;
        border-radius: 8px;
        padding: 14px 36px;
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 2px 12px #b2dfdb55;
        transition: background 0.2s, color 0.2s;
      }
      .hero .cta-btn:hover {
        background: #388e3c;
        color: #fff;
        border: 1px solid #fff;
      }
      .features-section {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 36px;
        margin: 0 auto;
        max-width: 1100px;
        padding: 48px 16px 32px 16px;
      }
      .feature-card {
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 8px 32px #b2dfdb88;
        width: 260px;
        min-height: 260px;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 28px 18px 22px 18px;
        transition: box-shadow 0.2s, transform 0.2s;
        cursor: pointer;
        text-align: center;
      }
      .feature-card:hover {
        box-shadow: 0 12px 36px #388e3c44;
        transform: translateY(-6px) scale(1.03);
      }
      .feature-card img {
        width: 60px;
        height: 60px;
        margin-bottom: 18px;
        border-radius: 12px;
        object-fit: cover;
        background: #e0ffe0;
      }
      .feature-title {
        font-size: 1.2em;
        font-weight: 600;
        color: #388e3c;
        margin-bottom: 0.5em;
      }
      .feature-desc {
        font-size: 1em;
        color: #333;
        margin-bottom: 1.2em;
      }
      .feature-card .start-btn {
        background: #388e3c;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 8px 22px;
        font-size: 1em;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
      }
      .feature-card .start-btn:hover {
        background: #2e7030;
      }
      /* Responsive */
      @media (max-width: 900px) {
        .features-section {
          flex-direction: column;
          align-items: center;
        }
        .feature-card {
          width: 90%;
          margin-bottom: 18px;
        }
      }
      /* Dark mode support */
      body.dark-mode {
        background: #222;
        color: #e0ffe0;
      }
      body.dark-mode .hero {
        background: linear-gradient(90deg, #222 0%, #388e3c 100%);
        color: #e0ffe0;
      }
      body.dark-mode .feature-card {
        background: #222;
        color: #e0ffe0;
        box-shadow: 0 8px 32px #00000088;
      }
      body.dark-mode .feature-title {
        color: #76ff03;
      }
      body.dark-mode .feature-desc {
        color: #e0ffe0;
      }
      body.dark-mode .feature-card .start-btn {
        background: #76ff03;
        color: #222;
      }
      body.dark-mode .feature-card .start-btn:hover {
        background: #388e3c;
        color: #fff;
      }
      /* Dropdown hover and active effect */
      .dropdown-content a:hover {
        background: #e0ffe0 !important;
        color: #222 !important;
      }
      /* Assistant popup dark mode */
      body.dark-mode #aiAssistantOverlay,
      #aiAssistantOverlay.dark-mode {
        background: rgba(0, 0, 0, 0.7) !important;
      }
      body.dark-mode .assistant-popup,
      #aiAssistantOverlay.dark-mode .assistant-popup {
        background: #1e1e1e !important;
        box-shadow: -4px 0 32px #00000088 !important;
        color: #e0ffe0;
      }
      body.dark-mode .assistant-popup h2 {
        color: #76ff03 !important;
      }
      body.dark-mode .assistant-popup .chat-area {
        background: #232323 !important;
        color: #e0ffe0 !important;
      }
      body.dark-mode .assistant-popup input {
        background: #333 !important;
        color: #e0ffe0 !important;
        border: 1px solid #76ff03 !important;
      }
      body.dark-mode .assistant-popup button.send-btn {
        background: #76ff03 !important;
        color: #222 !important;
      }
      body.dark-mode .assistant-popup button.send-btn:hover {
        background: #388e3c !important;
        color: #fff !important;
      }
      body.dark-mode .assistant-popup .close-btn {
        color: #76ff03 !important;
      }
    </style>
  </head>
  <body>
    <!-- Dropdown menu for navigation -->
    <div
      class="dropdown"
      style="position: fixed; top: 32px; right: 32px; z-index: 500"
    >
      <button
        onclick="toggleDropdown()"
        class="dropbtn"
        title="Menu"
        style="
          background: #fff;
          border-radius: 16px;
          border: none;
          width: 54px;
          height: 54px;
          box-shadow: 0 2px 12px #b2dfdb55;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
        "
      >
        <img
          src="icons/dropmenu.png"
          alt="Menu"
          style="width: 28px; height: 28px"
        />
      </button>
      <div
        id="myDropdown"
        class="dropdown-content"
        style="
          display: none;
          position: absolute;
          right: 0;
          top: 60px;
          background: #fff;
          min-width: 210px;
          box-shadow: 0 8px 32px #b2dfdb88;
          border-radius: 16px;
          overflow: hidden;
          padding: 10px 0;
        "
      >
        <a
          href="settings.html"
          style="
            display: flex;
            align-items: center;
            padding: 12px 22px;
            gap: 12px;
            font-size: 1.08em;
            color: #388e3c;
            text-decoration: none;
            transition: background 0.18s;
          "
        >
          <img src="icons/settings.png" class="foot" style="width: 22px" />
          Settings
        </a>
        <a
          href="community.html"
          style="
            display: flex;
            align-items: center;
            padding: 12px 22px;
            gap: 12px;
            font-size: 1.08em;
            color: #388e3c;
            text-decoration: none;
            transition: background 0.18s;
          "
        >
          <img src="icons/community.png" class="foot" style="width: 22px" />
          Community
        </a>
        <a
          href="farms.html"
          style="
            display: flex;
            align-items: center;
            padding: 12px 22px;
            gap: 12px;
            font-size: 1.08em;
            color: #388e3c;
            text-decoration: none;
            transition: background 0.18s;
          "
        >
          <img src="icons/farm.png" class="foot" style="width: 22px" /> Farms
        </a>
        <a
          href="user-profile.html"
          id="profileLink"
          style="
            display: flex;
            align-items: center;
            padding: 12px 22px;
            gap: 12px;
            font-size: 1.08em;
            color: #388e3c;
            text-decoration: none;
            transition: background 0.18s;
          "
        >
          <img
            src="icons/profile.jpg"
            class="foot"
            style="width: 22px; border-radius: 50%"
          />
          Profile
        </a>
      </div>
    </div>

    <!-- Dark mode toggle button on the left side -->
    <button
      id="darkModeToggle"
      style="
        position: fixed;
        top: 40px;
        left: 32px;
        z-index: 501;
        background: #b2dfdb;
        border: none;
        border-radius: 50%;
        width: 54px;
        height: 54px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 12px #b2dfdb55;
        cursor: pointer;
        transition: background 0.2s;
      "
      title="Toggle Dark Mode"
    >
      <img
        src="icons/darkmode.png"
        alt="Dark Mode"
        style="width: 28px; height: 28px"
      />
    </button>

    <!-- Add this language selector near the top, e.g. after the dark mode button -->
    <select
      id="languageSelect"
      style="
        position: fixed;
        top: 40px;
        left: 100px;
        z-index: 502;
        padding: 7px 16px;
        border-radius: 8px;
        border: 1px solid #b2dfdb;
        background: #fff;
        color: #388e3c;
        font-size: 1em;
      "
    >
      <option value="en">English</option>
      <option value="sw">Kiswahili</option>
    </select>

    <!-- Hero Section -->
    <div class="hero">
      <h1>AgriAi</h1>
      <p>
        Empowering Farmers with AI for a Better Harvest.<br />
        Get personalized insights, diagnosis, and recommendations for your farm.
      </p>
    </div>

    <!-- Features Section -->
    <div class="features-section">
      <div
        class="feature-card"
        onclick="location.href='disease-diagnosis.html'"
      >
        <img src="farm pics/farming.jpg" alt="Pest Diagnosis" />
        <div class="feature-title">Pest Diagnosis</div>
        <div class="feature-desc">
          Analyze crop images for pest identification and get treatment
          recommendations.
        </div>
        <button class="start-btn">Start</button>
      </div>
      <div class="feature-card" onclick="location.href='location.html'">
        <img src="farm pics/sky.jpg" alt="Weather Insights" />
        <div class="feature-title">Weather Insights</div>
        <div class="feature-desc">
          Get real-time weather updates and forecasts tailored to your crops.
        </div>
        <button class="start-btn">Start</button>
      </div>
      <div class="feature-card" id="cropAdvisoryCard">
        <img src="farm pics/crops.jpg" alt="Crop Advisory" />
        <div class="feature-title">Crop Advisory</div>
        <div class="feature-desc">
          Learn about crop preservation for higher yields and sustainable
          farming.
        </div>
        <button class="start-btn">Start</button>
      </div>
      <div class="feature-card" onclick="location.href='data-analytics.html'">
        <img src="farm pics/AI.jpg" alt="Data Analytics & Report" />
        <div class="feature-title">Data Analytics & Report</div>
        <div class="feature-desc">
          View your farm questions, AI answers, and interactive analytics
          reports.
        </div>
        <button class="start-btn">Start</button>
      </div>
    </div>

    <!-- AI Assistant Icon (fixed, bottom right) -->
    <div
      id="ai-assistant"
      style="
        position: fixed;
        bottom: 28px;
        right: 28px;
        z-index: 300;
        background: #fff;
        border-radius: 50%;
        box-shadow: 0 4px 16px #b2dfdb88;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: box-shadow 0.2s;
      "
      title="Ask Agri AI"
    >
      <img
        src="icons/ai.png"
        alt="AI Assistant"
        style="width: 38px; height: 38px"
      />
    </div>

    <!-- AI Assistant Overlay -->
    <div
      id="aiAssistantOverlay"
      style="
        display: none;
        position: fixed;
        top: 0;
        right: 0;
        width: 420px;
        height: 100vh;
        background: rgba(0, 0, 0, 0.35);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: flex-end;
      "
    >
      <div
        class="assistant-popup"
        id="assistantPopup"
        style="
          margin-left: auto;
          height: 92vh;
          max-height: 760px;
          width: 370px;
          background: #fff;
          border-radius: 24px 0 0 24px;
          box-shadow: -4px 0 32px #b2dfdb88;
          display: flex;
          flex-direction: column;
          position: relative;
        "
      >
        <button
          onclick="document.getElementById('aiAssistantOverlay').style.display='none'"
          title="Close"
          style="
            position: absolute;
            top: 18px;
            right: 18px;
            background: none;
            border: none;
            font-size: 2em;
            color: #388e3c;
            cursor: pointer;
          "
        >
          &times;
        </button>
        <div
          style="
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 36px;
          "
        >
          <img
            src="icons/ai.png"
            alt="AI Assistant"
            style="width: 60px; height: 60px; border-radius: 16px"
          />
          <h2 style="margin: 10px 0 4px 0; color: #388e3c">Bwana shamba</h2>
          <div style="font-size: 0.95em; color: #388e3c">
            Ask anything about your farm
          </div>
        </div>
        <div
          id="chatArea"
          style="
            flex: 1;
            background: #f4fef4;
            margin: 14px 18px 12px 18px;
            border-radius: 10px;
            padding: 14px;
            overflow-y: auto;
          "
        >
          Hello! How can I help you with your farming needs today?
        </div>
        <form
          id="chatForm"
          style="display: flex; gap: 6px; margin: 0 18px 18px 18px"
          autocomplete="off"
        >
          <input
            type="text"
            id="userInput"
            placeholder="Type your question..."
            required
            style="
              flex: 1;
              padding: 10px;
              border-radius: 8px;
              border: 1px solid #b2dfdb;
            "
          />
          <button
            type="submit"
            style="
              padding: 0 16px;
              height: 40px;
              background: #388e3c;
              border: none;
              border-radius: 8px;
              color: #fff;
              cursor: pointer;
            "
          >
            Send
          </button>
        </form>
      </div>
    </div>

    <script>
      // Dropdown menu toggle
      function toggleDropdown() {
        const dd = document.getElementById("myDropdown");
        dd.style.display = dd.style.display === "block" ? "none" : "block";
      }

      // Close dropdown if clicked outside
      window.onclick = function (event) {
        if (
          !event.target.matches(".dropbtn") &&
          !event.target.closest(".dropbtn")
        ) {
          const dropdowns = document.getElementsByClassName("dropdown-content");
          for (const openDropdown of dropdowns) {
            if (openDropdown.style.display === "block") {
              openDropdown.style.display = "none";
            }
          }
        }
      };

      // Dark mode toggle
      const darkModeToggleBtn = document.getElementById("darkModeToggle");
      darkModeToggleBtn.onclick = function (e) {
        e.preventDefault();
        const isDark = document.body.classList.toggle("dark-mode");
        localStorage.setItem("darkMode", isDark);

        const overlay = document.getElementById("aiAssistantOverlay");
        if (overlay) {
          overlay.classList.toggle("dark-mode", isDark);
        }
      };

      // Apply dark mode on load
      window.addEventListener("DOMContentLoaded", () => {
        const isDark = localStorage.getItem("darkMode") === "true";
        document.body.classList.toggle("dark-mode", isDark);

        const overlay = document.getElementById("aiAssistantOverlay");
        if (overlay) {
          overlay.style.display = "none"; // hide overlay on load
          overlay.classList.toggle("dark-mode", isDark);
        }

        // Set language from localStorage or default to English
        const lang = localStorage.getItem("agriLang") || "en";
        const languageSelect = document.getElementById("languageSelect");
        if (languageSelect) languageSelect.value = lang;
        updateLanguage(lang);
      });

      // Show AI Assistant overlay when icon or crop advisory card is clicked
      const aiIcon = document.getElementById("ai-assistant");
      const cropAdvisoryCard = document.getElementById("cropAdvisoryCard");
      const overlay = document.getElementById("aiAssistantOverlay");

      function showAIOverlay() {
        overlay.style.display = "flex";
        userInput.focus();

        const isDark = localStorage.getItem("darkMode") === "true";
        overlay.classList.toggle("dark-mode", isDark);
      }

      if (aiIcon) aiIcon.addEventListener("click", showAIOverlay);
      if (cropAdvisoryCard)
        cropAdvisoryCard.addEventListener("click", showAIOverlay);

      // Language translations
      const translations = {
        en: {
          heroTitle: "AgriAi",
          heroDesc:
            "Empowering Farmers with AI for a Better Harvest.<br>Get personalized insights, diagnosis, and recommendations for your farm.",
          features: [
            {
              title: "Pest Diagnosis",
              desc: "Analyze crop images for pest identification and get treatment recommendations.",
            },
            {
              title: "Weather Insights",
              desc: "Get real-time weather updates and forecasts tailored to your crops.",
            },
            {
              title: "Crop Advisory",
              desc: "Learn about crop preservation for higher yields and sustainable farming.",
            },
            {
              title: "Data Analytics & Report",
              desc: "View your farm questions, AI answers, and interactive analytics reports.",
            },
          ],
          aiTitle: "Agri AI Assistant",
          aiDesc: "Ask anything about your farm",
          aiPlaceholder: "Type your question...",
          aiHello: "Hello! How can I help you with your farming needs today?",
          aiReply: "AI",
          menu: {
            settings: "Settings",
            community: "Community",
            farms: "Farms",
            profile: "Profile",
          },
        },
        sw: {
          heroTitle: "AgriAi",
          heroDesc:
            "Kuwawezesha Wakulima kwa AI kwa Mavuno Bora.<br>Pata maarifa, utambuzi, na mapendekezo binafsi kwa shamba lako.",
          features: [
            {
              title: "Utambuzi wa Wadudu",
              desc: "Changanua picha za mazao kutambua wadudu na upate mapendekezo ya matibabu.",
            },
            {
              title: "Taarifa za Hali ya Hewa",
              desc: "Pata taarifa za hali ya hewa na utabiri maalum kwa mazao yako.",
            },
            {
              title: "Ushauri wa Mazao",
              desc: "Jifunze kuhusu uhifadhi wa mazao kwa mavuno mengi na kilimo endelevu.",
            },
            {
              title: "Takwimu & Ripoti",
              desc: "Tazama maswali yako ya shamba, majibu ya AI, na ripoti za takwimu.",
            },
          ],
          aiTitle: "Msaidizi wa AI wa Kilimo",
          aiDesc: "Uliza chochote kuhusu shamba lako",
          aiPlaceholder: "Andika swali lako...",
          aiHello:
            "Habari! Nawezaje kukusaidia kuhusu mahitaji yako ya kilimo leo?",
          aiReply: "AI",
          menu: {
            settings: "Mipangilio",
            community: "Jumuiya",
            farms: "Mashamba",
            profile: "Wasifu",
          },
        },
      };

      function updateLanguage(lang) {
        // Hero section
        const heroTitle = document.querySelector(".hero h1");
        const heroDesc = document.querySelector(".hero p");
        if (heroTitle) heroTitle.innerHTML = translations[lang].heroTitle;
        if (heroDesc) heroDesc.innerHTML = translations[lang].heroDesc;

        // Features section
        const featureCards = document.querySelectorAll(".feature-card");
        translations[lang].features.forEach((f, i) => {
          if (featureCards[i]) {
            const titleEl = featureCards[i].querySelector(".feature-title");
            const descEl = featureCards[i].querySelector(".feature-desc");
            const btnEl = featureCards[i].querySelector(".start-btn");
            if (titleEl) titleEl.textContent = f.title;
            if (descEl) descEl.textContent = f.desc;
            if (btnEl) btnEl.textContent = lang === "en" ? "Start" : "Anza";
          }
        });

        // Dropdown menu items
        const menu = translations[lang].menu;
        const settingsLink = document.querySelector(
          '#myDropdown a[href="settings.html"]'
        );
        const communityLink = document.querySelector(
          '#myDropdown a[href="community.html"]'
        );
        const farmsLink = document.querySelector(
          '#myDropdown a[href="farms.html"]'
        );
        const profileLink = document.querySelector(
          '#myDropdown a[href="user-profile.html"]'
        );

        if (settingsLink)
          settingsLink.innerHTML = `<img src="icons/settings.png" class="foot" style="width:22px;"> ${menu.settings}`;
        if (communityLink)
          communityLink.innerHTML = `<img src="icons/community.png" class="foot" style="width:22px;"> ${menu.community}`;
        if (farmsLink)
          farmsLink.innerHTML = `<img src="icons/farm.png" class="foot" style="width:22px;"> ${menu.farms}`;
        if (profileLink)
          profileLink.innerHTML = `<img src="icons/profile.jpg" class="foot" style="width:22px; border-radius:50%;"> ${menu.profile}`;
      }

      // Language selector event
      const languageSelect = document.getElementById("languageSelect");
      if (languageSelect) {
        languageSelect.addEventListener("change", (e) => {
          const lang = e.target.value;
          localStorage.setItem("agriLang", lang);
          updateLanguage(lang);
        });
      }

      // Chat Elements
      const chatForm = document.getElementById("chatForm");
      const userInput = document.getElementById("userInput");
      const chatArea = document.getElementById("chatArea");

      // Append chat message to chat area
      function appendMessage(sender, message) {
        const div = document.createElement("div");
        div.style.marginBottom = "10px";
        div.innerHTML = `<strong>${sender}:</strong> ${message}`;
        chatArea.appendChild(div);
        chatArea.scrollTop = chatArea.scrollHeight; // auto scroll
      }

      // Send message to backend
      async function sendMessageToBackend(message) {
        try {
          const response = await fetch("http://localhost:8081/incoming-sms-web", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              from: "web-user",
              to: "agri-ai-service",
              text: message,
              linkId: 123456789,
            }),
          });

          const text = await response.text();

          try {
            const data = JSON.parse(text);
            return data.reply || "Samahani, sijapata jibu kwa sasa.";
          } catch {
            // if response is not JSON, return it as-is
            return text;
          }
        } catch (error) {
          console.error("Error sending message:", error);
          return "Samahani, kuna tatizo kuwasiliana na server.";
        }
      }

      // Handle chat form submit
      if (chatForm && userInput && chatArea) {
        chatForm.addEventListener("submit", async (e) => {
          e.preventDefault();

          const message = userInput.value.trim();
          if (!message) return;

          appendMessage("You", message);
          userInput.value = "";
          userInput.disabled = true;

          const reply = await sendMessageToBackend(message);

          appendMessage("Bwana shamba", reply);
          userInput.disabled = false;
          userInput.focus();
        });
      }
    </script>
  </body>
</html>
